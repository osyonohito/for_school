// â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼
// â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼
// å•é¡Œ1~å•é¡Œ5ã®å•é¡Œæ–‡ã‚’èª­ã¿ã€æŒ‡å®šã•ã‚ŒãŸè¨˜è¿°ã‚’ã›ã‚ˆã€‚
// â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼
// â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼

// å•é¡Œï¼‘ï¼šå¤‰æ•°åã€ŒelementLocationNameã€ã§idã€Œlocation_nameã€ï¼ˆç¾åœ¨åœ°åã®è¦ç´ ï¼‰ã®å–å¾—ã‚’ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã›ã‚ˆ


// å•é¡Œï¼’ï¼šå¤‰æ•°åã€ŒelementWeatherIconã€ã§idã€Œweather_iconã€ï¼ˆå¤©æ°—ã®ã‚¢ã‚¤ã‚³ãƒ³ï¼‰ã®å–å¾—ã‚’ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã›ã‚ˆ


// å•é¡Œï¼“ï¼šå¤‰æ•°åã€ŒelementReloadIconã€ã§idã€Œreload_iconã€ï¼ˆãƒªãƒ­ãƒ¼ãƒ‰ã‚¢ã‚¤ã‚³ãƒ³ã®è¦ç´ ï¼‰ã®å–å¾—ã‚’ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã›ã‚ˆ


//â€»ä¸‹è¨˜ã‚’å‚è€ƒã«ã—ã¦è§£ãã¾ã—ã‚‡ã†
let elementNowTemperatureDegree = this.document.querySelector("#now_temperature_degree");//ç¾åœ¨ã®æ°—æ¸©ã®è¦ç´ 
let elementMaxTemperatureDegree = this.document.querySelector("#max_temperature_degree"); //æœ€é«˜æ°—æ¸©ã®è¦ç´ 
let elementMinTemperatureDegree = this.document.querySelector("#min_temperature_degree"); //æœ€ä½æ°—æ¸©ã®è¦ç´ 
let elementNowTemperatureUnit = document.querySelector("#now_temperature_unit"); //ç¾åœ¨ã®å˜ä½ã®è¦ç´ 
let elementMaxTemperatureUnit = document.querySelector("#max_temperature_unit"); //æœ€é«˜æ™‚ã®å˜ä½ã®è¦ç´ 
let elementMinTemperatureUnit = document.querySelector("#min_temperature_unit"); //æœ€ä½æ™‚ã®å˜ä½ã®è¦ç´ 
let elementWeatherDescription = this.document.querySelector("#weather_description"); //å¤©å€™åæƒ…å ±ã®è¦ç´ 
let elementDataHumidity = this.document.querySelector("#data_humidity"); //æ¹¿åº¦ã®å€¤ã®è¦ç´ 
let elementDataPressure = this.document.querySelector("#data_pressure"); //æ°—åœ§ã®å€¤ã®è¦ç´ 
let elementDataRainfallSnowfall = this.document.querySelector("#data_rainfall_snowfall"); //é™æ°´é‡ã®å€¤ã®è¦ç´ 
let elementDataWind = this.document.querySelector("#data_wind"); //é¢¨é€Ÿã®å€¤ã®è¦ç´ 
let elementDataCloudy = this.document.querySelector("#data_cloudy"); //é›²ã®é‡ã®è¦ç´ 
let elementDataSunriseSunset = this.document.querySelector("#data_sunrise_sunset"); //æ—¥ã®å‡ºå…¥ã®å€¤ã®è¦ç´ 
let elementLabelRainfallSnowfall = this.document.querySelector("#label_rainfall_snowfall"); //ã€Œé™æ°´é‡ã€ã®è¦ç´ 


//å•é¡Œï¼”ï¼šãƒšãƒ¼ã‚¸ã®èª­ã¿è¾¼ã¿ãŒå®Œäº†ã—ãŸã¨ãã«viewWeather()ãŒå®Ÿè¡Œã™ã‚‹ã‚ˆã†ã«ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã›ã‚ˆã€‚
/** ãƒšãƒ¼ã‚¸ã‚’èª­ã¿è¾¼ã‚“ã æ™‚ã«{}å†…ã«æ›¸ã„ãŸå‡¦ç†ãŒå‹•ã
* Â addEventListenerã¯ã€ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã«ç‰¹å®šã®ã‚¤ãƒ™ãƒ³ãƒˆãŒé…ä¿¡ã•ã‚Œã‚‹ãŸã³ã«å‘¼ã³å‡ºã•ã‚Œã‚‹é–¢æ•°
* ï¼ˆä»Šå›ã¯ã‚¿ãƒ¼ã‚²ãƒƒãƒˆï¼šwindow, ç‰¹å®šã®ã‚¤ãƒ™ãƒ³ãƒˆï¼šloadï¼‰ 

/*ã“ã“ã‚’é©åˆ‡ãªæ–‡å­—ã§ç½®ãæ›ãˆã¦ãã ã•ã„*/
.addEventListener("", () => {
/*ã“ã“ã«å®Ÿè¡Œã™ã‚‹é–¢æ•°ã‚’å®£è¨€ã›ã‚ˆ*/
viewWeather();
});

//å•é¡Œï¼•ï¼šãƒªãƒ­ãƒ¼ãƒ‰ã‚¢ã‚¤ã‚³ãƒ³ã®HTMLã‚’ã‚¯ãƒªãƒƒã‚¯ã—ãŸã¨ãã«viewWeather()ãŒå®Ÿè¡Œã™ã‚‹ã‚ˆã†ã«ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã›ã‚ˆã€‚
/** ãƒªãƒ­ãƒ¼ãƒ‰ã‚¢ã‚¤ã‚³ãƒ³ã‚’å‘¼ã³å‡ºã™å¤‰æ•°ã¯ä¸Šè¨˜å¤‰æ•°ç¾¤ã‹ã‚‰æ¢ã—ã¦ãã ã•ã„*/ 

/*ã“ã“ã‚’é©åˆ‡ãªæ–‡å­—ã§ç½®ãæ›ãˆã¦ãã ã•ã„*/
.addEventListener("", () => {
/*ã“ã“ã«å®Ÿè¡Œã™ã‚‹é–¢æ•°ã‚’å®£è¨€ã›ã‚ˆ*/
viewWeather();
});

/* è‡ªå·±ç´¹ä»‹ã§æ›¸ã„ãŸã‚‚ã®ã‚‚å‚è€ƒã«ã—ã¦ã¿ã‚ˆã† */
/* nicknameChange.addEventListener(â€œclickâ€,()=>{
  changeName():
}
  nicknameChangeï¼šã‚¯ãƒªãƒƒã‚¯ã™ã‚‹è¦ç´ 
  clickï¼šãƒˆãƒªã‚¬ãƒ¼ã«ãªã‚‹ã‚¤ãƒ™ãƒ³ãƒˆ
 */


// â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼
// â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼
// ä»¥é™ã®è¨˜è¿°ã¯ä¸è¦ã§ã™
// â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼
// â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼

function viewWeather() {
/** ä½ç½®æƒ…å ±ã®å–å¾—ã«å¯¾å¿œã—ã¦ã„ã‚‹ã‹ç¢ºèª */
  if (this.navigator.geolocation) {
    this.navigator.geolocation.getCurrentPosition(
      (position) => {
        let lon = position.coords.longitude; //çµŒåº¦
        let lat = position.coords.latitude;  //ç·¯åº¦

        const API_KEY = "b2f9c4c958b44e135d198778d5623f61"
        const URL = `https://api.openweathermap.org/data/2.5/weather?lat=${lat}&lon=${lon}&appid=${API_KEY}&units=metric&lang=ja`;

        this.fetch(URL).then((response) => {
          return response.json();
        }).then((data) => {

          //ï¼‘ï¼ãƒ‡ãƒ¼ã‚¿ã®å–ã‚Šå‡ºã—
          let weatherId = data.weather[0].id;
          let weatherIcon = data.weather[0].icon;
          let weatherDescription = data.weather[0].description;
          let temperature = data.main.temp;
          let minTemperature = data.main.temp_min;
          let maxTemperature = data.main.temp_max;
          let pressure = data.main.pressure;
          let humidity = data.main.humidity;
          let speed = data.wind.speed;
          let windDegree = data.wind.deg;
          let cloudsAll = data.clouds.all;
          let rainOrSnow = "rain" in data ? data.rain["1h"] : "snow" in data ? data.snow["1h"] : 0;
          let labelRainOrSnow = "rain" in data ? "é™æ°´é‡" : "snow" in data ? "é™é›ªé‡" : "é™æ°´é‡";
          let sunrise = data.sys.sunrise;
          let sunset = data.sys.sunset;
          let timezone = data.timezone;
          
          // â˜…äºˆå‚™ã®åœ°åï¼ˆOpenWeatherMapã®ã‚‚ã®ã€ä¾‹ï¼šã€Œå¤§æ›²ã€ï¼‰ã‚’ç¢ºä¿
          let fallbackName = data.name;

          elementNowTemperatureDegree.textContent = temperature;
          elementMinTemperatureDegree.textContent = minTemperature;
          elementMaxTemperatureDegree.textContent = maxTemperature;
          elementWeatherDescription.textContent = weatherDescription;
          elementDataHumidity.textContent = humidity;
          elementDataPressure.textContent = pressure;
          elementLabelRainfallSnowfall.textContent = labelRainOrSnow;
          elementDataRainfallSnowfall.textContent = rainOrSnow;
          elementDataWind.textContent = convertWindToString(speed, windDegree);
          elementDataCloudy.textContent = cloudsAll;
          elementDataSunriseSunset.textContent = cnvertSunriseSunsetToString(sunrise, sunset, timezone);

          // 1. ã¾ãšå›½åœŸåœ°ç†é™¢(GSI)ã®APIã‚’å‘¼ã³å‡ºã™
          const gsiUrl = `https://mreversegeocoder.gsi.go.jp/reverse-geocoder/LonLatToAddress?lat=${lat}&lon=${lon}`;

          this.fetch(gsiUrl)
            .then((res) => {
              if (!res.ok) {
                throw new Error("GSI API returned " + res.status);
              }
              return res.json();
            })
            .then((gsiData) => {
              // ã€æ—¥æœ¬ã®å ´åˆã€‘GSIã®è©³ç´°ãªåœ°åãƒ‡ãƒ¼ã‚¿ã‚’è§£æã—ã¦è¡¨ç¤º
              let muniCd = parseInt(gsiData.results.muniCd);

              if (typeof GSI === 'undefined' || !GSI.MUNI_ARRAY || !GSI.MUNI_ARRAY[muniCd]) {
                 throw new Error("è¾æ›¸ã‚¨ãƒ©ãƒ¼");
              }
              
              let detailArray = GSI.MUNI_ARRAY[muniCd].split(",");
              let prefecture = detailArray[1];    // çœŒ
              let municipalities = detailArray[3];// å¸‚ç”ºæ‘
              let localName = gsiData.results.lv01Nm || ""; 
              elementLocationName.textContent = `${prefecture} ${municipalities} ${localName}`;
            })
            .catch((error) => {
              const nominatimUrl = `https://nominatim.openstreetmap.org/reverse?format=json&lat=${lat}&lon=${lon}`;

              this.fetch(nominatimUrl)
                .then((res) => res.json())
                .then((osmData) => {
                  let detailedName = osmData.address.hamlet || osmData.address.village || osmData.address.town || osmData.address.city || osmData.address.county;
                  let country = osmData.address.country;

                  if (detailedName) {
                     elementLocationName.textContent = `${country}, ${detailedName}`;
                  } else {
                     elementLocationName.textContent = fallbackName;
                  }
                })
                .catch((osmError) => {
                   elementLocationName.textContent = fallbackName;
                });
            });
          
          // â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²

          setIcons(weatherIcon, elementWeatherIcon, weatherId);

          //ã‚«æ°ã®å˜ä½ã‚’ã‚»æ°ã«å¤‰æ›
          if (elementNowTemperatureUnit.textContent === "â„‰") {
            elementNowTemperatureUnit.textContent = "â„ƒ";
            elementMaxTemperatureUnit.textContent = "â„ƒ";
            elementMinTemperatureUnit.textContent = "â„ƒ";
          }

        }).catch((fail) => {
          this.alert("OpenWeatherMapã«æ¥ç¶šã§ãã¾ã›ã‚“ã§ã—ãŸ");
        })
      },
      (fail) => {
        this.alert("ä½ç½®æƒ…å ±ãŒå–å¾—ã§ãã¾ã›ã‚“ã§ã—ãŸ")
      }
    );
  }
}


/**
 * --------------------------------------------------------
 * âš ï¸ setNameGoogleMapsé–¢æ•°ã¯ã€Google Maps APIã‚’ä½¿ç”¨ã—ãªã„ãŸã‚å‰Šé™¤ã—ã¾ã—ãŸã€‚
 * --------------------------------------------------------
 */


/**
Â * ä»¥ä¸‹ã€æ—¥ã®å‡º/æ—¥ã®å…¥ã‚Šæ™‚åˆ»ã‚’è¿”ã™é–¢æ•°
Â */

//æ—¥ã®å‡ºã€æ—¥ã®å…¥ã‚Šæ™‚åˆ»ã‚’æ±‚ã‚æ–‡å­—åˆ—ã«å¤‰æ›ã™ã‚‹
//å®Ÿè¡Œã™ã‚‹é–¢æ•°ã§dataã®ä¸­ã«å…¥ã£ã¦ã„ã‚‹sunriseã¨sunsetã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹
function cnvertSunriseSunsetToString(sunrise, sunset, timezone) {
Â  let stringSunrise = convertUnixTimeToHourMinute(sunrise, timezone);
Â  let stringSunset = convertUnixTimeToHourMinute(sunset, timezone);
Â  let formatString = stringSunrise + " - " + stringSunset;

Â  return formatString;
}

function convertUnixTimeToHourMinute(unixTime, timezone) {
Â  let timestamp = (unixTime * 1000 + timezone); Â  Â  Â  Â  Â  Â  Â  Â  //unixTimeï¼šã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ã‚¿ãƒ¼ã‚·ã‚¹ãƒ†ãƒ ä¸Šã§ã®æ™‚åˆ»è¡¨ç¾ã®ä¸€ç¨®ã€timezoneï¼šå ´æ‰€ã”ã¨ã®æ¨™æº–æ™‚é–“å¸¯
Â  let date = new Date(timestamp); Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  //ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ã‹ã‚‰æ™‚é–“ã‚’ç”Ÿæˆï¼šã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ã‚’new Date()ã§åˆæœŸåŒ–ã™ã‚‹éš›ã«å¼•æ•°ã¨ã—ã¦æŒ‡å®šã€€â€»timestamp(ãƒŸãƒªç§’)
Â  let formatString = date.getHours() + ":" + date.getMinutes();

Â  return formatString;
}



/**
Â * æ–¹è§’ã¨é¢¨é€Ÿã‚’1ã¤ã®æ–‡å­—åˆ—ã¨ã—ã¦è¿”ã™é–¢æ•°
Â */
function convertWindToString(speed, degree) {
Â  const DIRECTION_LIST = ["åŒ—", "åŒ—åŒ—æ±", "åŒ—æ±", "æ±åŒ—æ±", "æ±", "æ±å—æ±", "å—æ±", "å—å—æ±", "å—", "å—å—è¥¿", "å—è¥¿", "è¥¿å—è¥¿", "è¥¿", "è¥¿åŒ—è¥¿", "åŒ—è¥¿", "åŒ—åŒ—è¥¿", "åŒ—"];
Â  let index = Math.round(degree / 22.5);//degree=é¢¨ã®è§’åº¦(360åº¦ä¸­) Â 22.5=360ã‚’16ã§å‰²ã£ãŸå€¤â¡å‰²ã£ãŸçµæœï¼è¦ç´ ç•ªå·ã€€
Â  let formatString = DIRECTION_LIST[index] + " " + speed;

Â  return formatString;
}



/**
Â * çœŒåã¨å¸‚åã‚’æ›¸ãæ›ãˆã‚‹(ç·¯åº¦,çµŒåº¦ã‹ã‚‰åœ°åã‚’æ±‚ã‚ã¦è¨­å®šã™ã‚‹)é–¢æ•°
Â * âš ï¸ å›½åœŸåœ°ç†é™¢ (GSI) ã® API ã‚’ä½¿ç”¨ã—ã¦ã„ã¾ã™ã€‚
Â */
function setName(lon, lat, nameId) {
Â  const URL = `https://mreversegeocoder.gsi.go.jp/reverse-geocoder/LonLatToAddress?lat=${lat}&lon=${lon}`;

Â  //fetchã®æˆ»ã‚Šå€¤ãŒresponseã«å…¥ã‚Šã€response.json()ã®æˆ»ã‚Šå€¤ãŒdataã«å…¥ã‚‹
Â  this.fetch(URL).then((response) => {
Â  Â  return response.json();
Â  }).then((data) => {

Â  Â  /**
Â  Â  Â * ï¼‘ï¼muni.js(ãƒ­ãƒ¼ã‚«ãƒ«ãƒ•ã‚¡ã‚¤ãƒ«)ã§åœ°åã‚’ç®¡ç†ã—ã¦ã„ã‚‹GSI(å›½åœŸäº¤é€šçœå›½åœŸåœ°ç†é™¢)ã®muniCd(é…åˆ—ã®è¦ç´ ç•ªå·)ã§åœ°åŸŸåã‚’æŒ‡å®š
Â  Â  Â * ï¼’ï¼ã€Œï¼‘ï¼ã€ã‚’åŸºæº–ã«è©³ç´°ã‚’å–å¾—ã—ã¦ã„ã
Â  Â  Â * ï¼“. çœŒã¨å¸‚ã®HTMLè¦ç´ ã®æ›¸ãæ›ãˆ
Â  Â  Â * parseInté–¢æ•°ï¼šæ–‡å­—åˆ—ã®å¼•æ•°ã‚’è§£æã—ã€æŒ‡å®šã•ã‚ŒãŸåŸºæ•° (æ•°å­¦çš„è¨˜æ•°æ³•ã®åº•) ã®æ•´æ•°å€¤ã‚’è¿”ã™
Â  Â  Â */

Â  Â  //ï¼‘
Â  Â  let muniCd = parseInt(data.results.muniCd);
Â  Â  let detailArray = GSI.MUNI_ARRAY[muniCd].split(","); //spilitã‚‚ç”¨ã„ã¦ã€éƒ½é“åºœçœŒåã¨å¸‚åŒºç”ºæ‘ã‚’(ã‚«ãƒ³ãƒã§)åˆ†ã‘ã¦å–å¾—

Â  Â  //ï¼’
Â  Â  let prefecture = detailArray[1]; Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  //splitã§åˆ†å‰²ã—ãŸéš›ã€å¤šé‡é…åˆ—ã«ãªã£ã¦ã„ã‚‹[muniCd][muniCdã§ç´°åˆ†åŒ–ã—ãŸè¦ç´ ç•ªå·]
Â  Â  let municipalities = detailArray[3];
Â  Â  let formatString = `${prefecture} ${municipalities}`;

Â  Â  //ï¼“
Â  Â  nameId.textContent = formatString;

Â  Â  /**
Â  Â  Â * ç–‘å•ç‚¹
Â  Â  Â * ãƒ»importã›ãšã€å¤–éƒ¨ãƒ•ã‚¡ã‚¤ãƒ«ã®ã‚¯ãƒ©ã‚¹åˆ©ç”¨ã§ãã‚‹ï¼Ÿ
Â  Â  Â */

Â  }).catch((error) => {
        // GSI APIã®é€šä¿¡ã‚¨ãƒ©ãƒ¼ã‚„ãƒ‡ãƒ¼ã‚¿å‡¦ç†ã‚¨ãƒ©ãƒ¼ã‚’ã‚­ãƒ£ãƒƒãƒ
        nameId.textContent = "åœ°åå–å¾—ã‚¨ãƒ©ãƒ¼";
        console.error("GSI Geocoding APIé€šä¿¡ã‚¨ãƒ©ãƒ¼:", error);
    });
}



/**
Â * å¤©æ°—ã®ã‚¢ã‚¤ã‚³ãƒ³ã‚’è¨­å®šã™ã‚‹é–¢æ•°
Â */
function setIcons(icon, element, weatherID) {
Â  let currentIcon;

Â  /**
Â  Â * iconã®ä¸€ç•ªå¾Œã‚ã®æ–‡å­—ã ã‘ã§æ¡ä»¶åˆ†å²
Â  Â * Â  Â * substrãƒ¡ã‚½ãƒƒãƒ‰ ï¼šä»»æ„ã®æ–‡å­—åˆ—ã®ä¸­ã‹ã‚‰æŒ‡å®šã—ãŸæ–‡å­—åˆ—ã‚’æŠ½å‡ºã—ã¦åˆ‡ã‚Šå‡ºã™ãƒ¡ã‚½ãƒƒãƒ‰
Â  Â * æ§‹æ–‡ã€€ã€€ã€€ã€€ã€€ã€€ï¼šstr.substr( é–‹å§‹ä½ç½®, åˆ‡ã‚Šå‡ºã™é•·ã• ) 
Â  Â * è£œè¶³ã€€ã€€ã€€ã€€ã€€ã€€ï¼šé•·ã•ã¯çœç•¥å¯èƒ½
Â  Â * ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€è² ã®æ•°ã‚’æŒ‡å®šã™ã‚‹å ´åˆã€æ–‡å­—åˆ—ã®æœ«å°¾ã‹ã‚‰æ•°ãˆã‚‹
Â  Â */
Â  if (icon.substr(-1) === "d") {//åˆå‰
Â  Â  switch (icon) {
Â  Â  Â  case "01d"://æ™´ã‚Œ
Â  Â  Â  Â  currentIcon = "CLEAR_DAY";
Â  Â  Â  Â  break;

Â  Â  Â  case "02d"://æ™´ã‚Œ
Â  Â  Â  Â  currentIcon = "PARTLY_CLOUDY_DAY";
Â  Â  Â  Â  break;

Â  Â  Â  case "03d"://æ™´ã‚Œ
Â  Â  Â  Â  currentIcon = "PARTLY_CLOUDY_DAY";
Â  Â  Â  Â  break;

Â  Â  Â  case "04d"://æ›‡ã‚Š
Â  Â  Â  Â  if (weatherID === 804) {
Â  Â  Â  Â  Â  currentIcon = "CLOUDY";
Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  currentIcon = "PARTLY_CLOUDY_DAY";
Â  Â  Â  Â  }
Â  Â  Â  Â  break;

Â  Â  Â  case "09d": //é›¨ ã€ŒweatherIDãŒ520,521,522,531ã®ä¸­ã«å«ã¾ã‚Œã¦ã„ãŸã‚‰ã€ã®æ¡ä»¶åˆ†å²
Â  Â  Â  Â  if ([520, 521, 522, 531].includes(weatherID)) {
Â  Â  Â  Â  Â  /**
Â  Â  Â  Â  Â  Â * includes
Â  Â  Â  Â  Â  Â * Â  Â  Â  Â  Â  Â * é…åˆ—å†…ã«ã‚ã‚‹ç‰¹å®šã®è¦ç´ ãŒå­˜åœ¨ã™ã‚‹ã‹ã©ã†ã‹ã‚’ãƒã‚§ãƒƒã‚¯
Â  Â  Â  Â  Â  * æ§‹æ–‡ï¼šé…åˆ—.includes(è¦ç´ )
Â  Â  Â  Â  Â  * æˆ»å€¤ï¼šå¼•æ•°ã«æŒ‡å®šã—ãŸè¦ç´ ãŒé…åˆ—å†…ã«å«ã¾ã‚Œã¦ã„ã‚Œã°trueã‚’è¿”ã—ã€å«ã¾ã‚Œã¦ã„ãªã„å ´åˆã¯falseã‚’è¿”ã™
Â  Â  Â  Â  Â  * å‚™è€ƒï¼šé…åˆ—ï¼ˆArrayï¼‰ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®æ—¢å­˜ãƒ¡ã‚½ãƒƒãƒ‰ã®ã²ã¨ã¤
Â  Â  Â  Â  Â  */

Â  Â  Â  Â  Â  currentIcon = "SHOWERS_DAY";
Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  currentIcon = "SLEET"; //ã¿ãã‚Œ
Â  Â  Â  Â  }
Â  Â  Â  Â  break;

Â  Â  Â  case "10d"://é›¨
Â  Â  Â  Â  currentIcon = "RAIN";
Â  Â  Â  Â  break;

Â  Â  Â  case "13d"://é›ª
Â  Â  Â  Â  if ([620, 621, 622].includes(weatherID)) {
Â  Â  Â  Â  Â  currentIcon = "SNOW_SHOWERS_DAY"
Â  Â  Â  Â  } else if ([615, 616].includes(weatherID)) {
Â  Â  Â  Â  Â  currentIcon = "RAIN_SNOW_SHOWERS_DAY";
Â  Â  Â  Â  } else if ([611, 612, 613].includes(weatherID)) {
Â  Â  Â  Â  Â  currentIcon = "RAIN_SNOW";
Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  currentIcon = "SNOW";
Â  Â  Â  Â  }
Â  Â  Â  Â  break;

Â  Â  Â  case "11d"://é›·
Â  Â  Â  Â  if ([200, 230].includes(weatherID)) {
Â  Â  Â  Â  Â  currentIcon = "THUNDER_SHOWERS_DAY";
Â  Â  Â  Â  } else if ([210, 211, 212, 221].includes(weatherID)) {
Â  Â  Â  Â  Â  currentIcon = "THUNDER";
Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  currentIcon = "THUNDER_RAIN";
Â  Â  Â  Â  }
Â  Â  Â  Â  break;

Â  Â  Â  case "50d"://ãã®ä»–ï¼ˆéœ§ã€ç«œå·»ãªã©ï¼‰
Â  Â  Â  Â  currentIcon = "FOG";
Â  Â  Â  Â  break;
Â  Â  }
Â  } else {//åˆå¾Œ
Â  Â  switch (icon) {
Â  Â  Â  case "01n"://æ™´ã‚Œ
Â  Â  Â  Â  currentIcon = "CLEAR_NIGHT";
Â  Â  Â  Â  break;

Â  Â  Â  case "02n"://æ™´ã‚Œ
Â  Â  Â  Â  currentIcon = "PARTLY_CLOUDY_DAY";
Â  Â  Â  Â  break;

Â  Â  Â  case "03n"://æ™´ã‚Œ
Â  Â  Â  Â  currentIcon = "PARTLY_CLOUDY_DAY";
Â  Â  Â  Â  break;

Â  Â  Â  case "04n"://æ›‡ã‚Š
Â  Â  Â  Â  if (weatherID === 804) {
Â  Â  Â  Â  Â  currentIcon = "CLOUDY";
Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  currentIcon = "PARTLY_CLOUDY_NIGHT";
Â  Â  Â  Â  }
Â  Â  Â  Â  break;

Â  Â  Â  case "09n"://é›¨
Â  Â  Â  Â  if ([520, 521, 522, 531].includes(weatherID)) {
Â  Â  Â  Â  Â  currentIcon = "SHOWERS_NIGHT";
Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  currentIcon = "SLEET";
Â  Â  Â  Â  }
Â  Â  Â  Â  break;

Â  Â  Â  case "10n"://é›¨
Â  Â  Â  Â  currentIcon = "RAIN";
Â  Â  Â  Â  break;

Â  Â  Â  case "13n"://é›ª
Â  Â  Â  Â  if ([620, 621, 622].includes(weatherID)) {
Â  Â  Â  Â  Â  currentIcon = "SNOW_SHOWERS_NIGHT"
Â  Â  Â  Â  } else if ([615, 616].includes(weatherID)) {
Â  Â  Â  Â  Â  currentIcon = "RAIN_SNOW_SHOWERS_NIGHT";
Â  Â  Â  Â  } else if ([611, 612, 613].includes(weatherID)) {
Â  Â  Â  Â  Â  currentIcon = "RAIN_SNOW";
Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  currentIcon = "SNOW";
Â  Â  Â  Â  }
Â  Â  Â  Â  break;

Â  Â  Â  case "11n"://é›·
Â  Â  Â  Â  if ([200, 230].includes(weatherID)) {
Â  Â  Â  Â  Â  currentIcon = "THUNDER_SHOWERS_NIGHT";
Â  Â  Â  Â  } else if ([210, 211, 212, 221].includes(weatherID)) {
Â  Â  Â  Â  Â  currentIcon = "THUNDER";
Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  currentIcon = "THUNDER_RAIN";
Â  Â  Â  Â  }
Â  Â  Â  Â  break;

Â  Â  Â  case "50n"://ãã®ä»–ï¼ˆéœ§ã€ç«œå·»ãªã©ï¼‰
Â  Â  Â  Â  currentIcon = "FOG";
Â  Â  Â  Â  break;
Â  Â  }
Â  }
Â  //skyconsã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ç”Ÿæˆæ™‚ã«ã€Œcolorã¯ç™½ã§ã™ã€ã®æŒ‡å®šï¼ˆJSONã§è¨˜è¿°ï¼‰
Â  const skycons = new Skycons({ color: "white" });
Â  skycons.play();
Â  skycons.set(element, Skycons[currentIcon]);


Â  /**
Â  Â * ğŸŒŸç–‘å•ç‚¹ï¼“ç‚¹
Â  Â * ãƒ»skyconsã®constructorã®å¼•æ•°ã€€ã‚­ãƒ¼ãƒãƒªãƒ¥ãƒ¼(Mapçš„ãªã‚‚ã®)ã§æ ¼ç´ï¼Ÿ
Â  Â * ãƒ»skyconsã®å‡¦ç†å†…å®¹ãµããƒ¼
Â  Â * ãƒ»playã‚„setã‚’ã‚­ãƒ¼ã¨ã—ã¦é–¢æ•°ã‚’å®Ÿè¡Œã—ã¦ã„ã‚‹ï¼Ÿskyconsã«ã¦
Â  Â * ãƒ»playã‚„setã¯ãã‚Œãã‚Œä½•ã‚’è¡Œã£ã¦ã„ã‚‹é–¢æ•°ï¼Ÿthis=Skyconså¤‰æ•°ï¼Ÿ
Â  Â * Â  Â * â¡ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®å‡¦ç†ã¯ã€Œã“ã‚Œã‚’æ›¸ã‘ã°ã“ã®çµæœã«ãªã‚‹ã€ç¨‹åº¦ã§ã‚‚ã„ã„ã€‚ã‚µã‚¤ãƒˆã«ã‚‚ãã†æ›¸ã„ã¦ã‚ã‚‹ã“ã¨ãŒä¸»ã€‚
Â  Â * â€»è¬›å¸«ã®æ–¹ã«èã
Â  Â */
}






/**ä»¥ä¸‹ã‚ˆã‚Šã‚»æ°â‡”ã‚«æ°ã§å¤‰æ›ã™ã‚‹ã‚¤ãƒ™ãƒ³ãƒˆå‡¦ç† */





//ç¾åœ¨ã®æ°—æ¸©ã‚’ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã¨ã€ã‚»æ°â‡”ã‚«æ°ã§ç›¸äº’å¤‰æ›ãŒå¯èƒ½
elementNowTemperatureDegree.addEventListener("click", () => {
Â  //parseFloatã¯æ–‡å­—åˆ—ã‚’æµ®å‹•å°æ•°ç‚¹å‹ã«å¤‰ãˆã‚‹
Â  //textContentã¯ã€ãƒ†ã‚­ã‚¹ãƒˆã‚’æ–‡å­—åˆ—ã§å–å¾—ã™ã‚‹
Â  let nowTemperatureDegree = parseFloat(elementNowTemperatureDegree.textContent);
Â  let maxTemperatureDegree = parseFloat(elementMaxTemperatureDegree.textContent);
Â  let minTemperatureDegree = parseFloat(elementMinTemperatureDegree.textContent);
Â  let unit = elementNowTemperatureUnit.textContent;
Â  if (unit === "â„ƒ") {//ã‚»æ°ã€€â†’ã€€ã‚«æ°
Â  Â  //æ¸¡ã•ã‚ŒãŸå¤‰æ•°ã‚’å—ã‘å–ã‚Šã€Cã¨å‘¼ã°ã‚Œã‚‹å¤‰æ•°ã«æ ¼ç´ã€‚ãã®å¾Œ1.8ã‚’æ›ã‘ã¦32ã‚’åŠ ãˆã¦ã‚«æ°ã«å¤‰æ›ã™ã‚‹
Â  Â  elementNowTemperatureDegree.textContent = convertCToF(nowTemperatureDegree);
Â  Â  elementNowTemperatureUnit.textContent = "â„‰";
Â  Â  elementMaxTemperatureDegree.textContent = convertCToF(maxTemperatureDegree);
Â  Â  elementMaxTemperatureUnit.textContent = "â„‰";
Â  Â  elementMinTemperatureDegree.textContent = convertCToF(minTemperatureDegree);
Â  Â  elementMinTemperatureUnit.textContent = "â„‰";
Â  } else {//ã‚«æ°ã€€â†’ã‚»æ°
Â  Â  //æ¸¡ã•ã‚ŒãŸå€¤ã‹ã‚‰32ã‚’å¼•ã„ã¦1.8ã§å‰²ã£ã¦ã€ã‚»æ°ã«å¤‰æ›´ã™ã‚‹
Â  Â  elementNowTemperatureDegree.textContent = convertFToC(nowTemperatureDegree);
Â  Â  elementNowTemperatureUnit.textContent = "â„ƒ";
Â  Â  elementMaxTemperatureDegree.textContent = convertFToC(maxTemperatureDegree);
Â  Â  elementMaxTemperatureUnit.textContent = "â„ƒ";
Â  Â  elementMinTemperatureDegree.textContent = convertFToC(minTemperatureDegree);
Â  Â  elementMinTemperatureUnit.textContent = "â„ƒ";
Â  }
})



//ã‚»æ°ã‚’ã‚«æ°ã«å¤‰æ›
function convertCToF(data) {
Â  return Math.round((data * 1.8 + 32) * 100) / 100;
}

//ã‚«æ°ã‚’ã‚»æ°ã«å¤‰æ›
function convertFToC(data) {
Â  return Math.round(((data - 32) / 1.8) * 100) / 100;
}